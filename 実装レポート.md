# 旅行費用精算アプリケーション - 実装レポート

## 概要
友人との旅行で発生した費用を簡単に精算できるWebアプリケーションを実装しました。データベースを使用せず、セッション内で完結する設計により、プライバシーを保護しながら使いやすいインターフェースを提供します。

## 主な工夫点

### 1. ユーザビリティを重視したUI/UX設計
- **直感的なレイアウト**: 左側に参加者と通貨設定、右側にメインコンテンツを配置し、操作の流れを明確化
- **タブ切り替え**: 支払い記録と精算画面をタブで切り替え、画面遷移なしでスムーズな操作を実現
- **リアルタイム更新**: 全ての操作が即座に反映され、ユーザーは常に最新の状態を確認可能
- **視覚的フィードバック**: 収支の色分け（プラス：緑、マイナス：赤）により、一目で状況を把握

### 2. コンポーネント設計の最適化
- **単一責任の原則**: 各コンポーネントは明確な役割を持つように設計
  - `ParticipantList`: 参加者の追加・削除・表示
  - `ExpenseForm`: 支払い情報の入力フォーム
  - `ExpenseList`: 支払い記録の一覧表示
  - `SettlementView`: 精算計算と結果表示
  - `CurrencySettings`: 通貨設定と為替レート管理
- **状態管理**: メインコンポーネント（`page.tsx`）で状態を一元管理し、props経由で子コンポーネントに配布

### 3. 堅牢なバリデーション処理
- **入力値検証**: 
  - 金額のマイナス値を防止（`min="0"`属性と検証ロジック）
  - 空文字や無効な値の入力を防止
  - 重複する参加者名の登録を防止
- **エラーメッセージ**: ユーザーに分かりやすいエラーメッセージを表示
- **必須項目チェック**: 支払者と割り勘対象者の選択を必須化

### 4. 精算アルゴリズムの最適化
- **最小取引数アルゴリズム**: 債権者と債務者をソートし、効率的にマッチングすることで取引回数を最小化
- **小数点処理**: 
  - 計算過程では高精度を維持
  - 最終的な精算額は小数点第2位で丸め処理（`Math.round(amount * 100) / 100`）
  - 0.01円未満の誤差は無視することで、実用的な精算を実現

### 5. 複数通貨対応
- **リアルタイム為替レート取得**: ExchangeRate-API を使用して最新の為替レートを取得
- **基準通貨の変更**: ユーザーが基準通貨を自由に変更可能
- **手動レート調整**: API障害時やオフライン環境でも手動でレートを設定可能
- **通貨換算の可視化**: 異なる通貨での支払いも基準通貨に換算して表示

### 6. レスポンシブデザイン
- **TailwindCSS**: ユーティリティファーストのCSSフレームワークを活用
- **グリッドレイアウト**: 画面サイズに応じて1カラム/3カラムレイアウトを自動切り替え
- **モバイル対応**: スマートフォンでも快適に使用できるUI設計

### 7. 開発環境の整備
- **TypeScript**: 型安全性を確保し、開発時のエラーを削減
- **Docker対応**: 本番環境へのデプロイを容易にするDockerfile を用意
- **Next.js App Router**: 最新のNext.js機能を活用した高速なアプリケーション

## 技術的な実装詳細

### 状態管理
```typescript
// 主要な状態
- participants: 参加者リスト
- expenses: 支払い記録
- currencies: 利用可能な通貨と為替レート
- baseCurrency: 基準通貨
```

### 精算計算ロジック
1. 各参加者の収支を計算（支払額 - 負担額）
2. 債権者（プラス収支）と債務者（マイナス収支）に分類
3. 金額の大きい順にソートし、効率的にマッチング
4. 最小限の取引で全員の収支をゼロに

### セキュリティとプライバシー
- クライアントサイドのみで動作し、個人情報はサーバーに送信されない
- セッション終了時にデータは自動的に消去

## まとめ
本アプリケーションは、実用性とユーザビリティを重視した設計により、旅行の費用精算を簡単かつ正確に行えるツールとして完成しました。特に、複数通貨対応と最適化された精算アルゴリズムにより、国内外の旅行で幅広く活用できます。